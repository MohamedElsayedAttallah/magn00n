{% extends "base.html" %}
{% load static %}

{% block content %}
<div class="card p-4">
    <h2 class="text-center mb-4" style="color: #FFA500;">Car Sound Detector & Speed Predictor</h2>

    <div id="drop-zone-cars" class="dropzone mb-4">
        <p><strong>Drag and Drop your audio file (.wav / .mp3) here</strong> (Click to Select)</p>
        <small class="text-secondary">Audio will be analyzed for speed prediction and visualization.</small>
        <input type="file" id="cars-file-input" accept=".wav,.mp3" style="display: none;">
    </div>

    <div id="cars-status" class="alert alert-info" role="alert">
        Awaiting audio file upload...
    </div>

    <div class="d-flex justify-content-center mb-4">
        <button id='analyze-cars-button' class="btn btn-success me-3" disabled>Analyze Audio</button>
        <button id='predict-speed-button' class="btn btn-warning me-3" disabled>Predict Speed</button>
        <button id='play-cars-button' class="btn btn-secondary" disabled>Play Original Audio</button>
    </div>

    <!-- Speed Prediction Result -->
    <div id='speed-prediction-result' class="mt-4 text-center" style="display: none;">
        <div class="card p-4" style="background-color: #1a1f2e; border: 3px solid #FFA500;">
            <h3 style="color: #FFA500;">üèéÔ∏è Predicted Vehicle Speed</h3>
            <h1 id="predicted-speed-value" style="color: #58a6ff; font-size: 4rem; font-weight: bold;">0.00 km/h</h1>
            <div class="row mt-3">
                <div class="col-md-4">
                    <small class="text-secondary">Model</small>
                    <p id="checkpoint-name" style="color: #c9d1d9;">-</p>
                </div>
                <div class="col-md-4">
                    <small class="text-secondary">Sample Rate</small>
                    <p id="checkpoint-variance" style="color: #c9d1d9;">-</p>
                </div>
                <div class="col-md-4">
                    <small class="text-secondary">Clip Duration</small>
                    <p id="checkpoint-mae" style="color: #c9d1d9;">-</p>
                </div>
            </div>
        </div>
    </div>

    <!-- Original Audio Player -->
    <div id='audio-player-cars-original' class="mb-4">
        <h5 style="color: #FFA500;">Original Audio Player:</h5>
    </div>

    <!-- Original Audio Time Domain Graph -->
    <div class="graph-container">
        <div id='time-domain-graph-cars-original' style='height: 350px;'></div>
    </div>

    <!-- Frequency Domain Graph -->
    <div class="graph-container mt-4">
        <div id='frequency-domain-graph-cars' style='height: 350px;'></div>
    </div>

    <!-- Nyquist Frequency Analysis Section -->
    <div id='nyquist-section-cars' class="mt-4" style="display: none;">
        <div class="card p-3" style="background-color: #161b22; border: 1px solid #30363d;">
            <h4 class="text-center mb-3" style="color: #FFA500;">Nyquist Frequency Analysis</h4>
            <div class="row mb-3">
                <div class="col-md-3 text-center">
                    <div class="p-2" style="border: 1px solid #30363d; border-radius: 5px;">
                        <small class="text-secondary">Original Sample Rate</small>
                        <h5 id="cars-original-sr" style="color: #58a6ff;">16000 Hz</h5>
                    </div>
                </div>
                <div class="col-md-3 text-center">
                    <div class="p-2" style="border: 1px solid #30363d; border-radius: 5px;">
                        <small class="text-secondary">Current Sample Rate</small>
                        <h5 id="cars-current-sr" style="color: #FFA500;">16000 Hz</h5>
                    </div>
                </div>
                <div class="col-md-3 text-center">
                    <div class="p-2" style="border: 1px solid #30363d; border-radius: 5px;">
                        <small class="text-secondary">Original Max Frequency</small>
                        <h5 id="cars-max-freq" style="color: #f78166;">0 Hz</h5>
                    </div>
                </div>
                <div class="col-md-3 text-center">
                    <div class="p-2" style="border: 1px solid #30363d; border-radius: 5px;">
                        <small class="text-secondary">Nyquist Frequency</small>
                        <h5 id="cars-nyquist-freq" style="color: #79c0ff;">0 Hz</h5>
                        <small class="text-secondary" style="font-size: 0.75rem;">F(nyquist) = 2 √ó F(max)</small>
                    </div>
                </div>
            </div>
            <div class="text-center mb-3">
                <h5 id="cars-sampling-status" style="color: #FFA500;">Analyzing...</h5>
            </div>
            <div class="mb-3">
                <label for="cars-resample-slider" class="form-label">
                    <strong>Adjust Sample Rate:</strong> <span id="cars-current-sr-display" style="color: #FFA500;">16000 Hz</span>
                </label>
                <input type="range" class="form-range" id="cars-resample-slider" min="1000" max="48000" step="500" value="16000">
                <div class="d-flex justify-content-between">
                    <small class="text-secondary">1 kHz (step: 500 Hz)</small>
                    <small class="text-secondary">48 kHz</small>
                </div>
            </div>
            <div class="text-center mb-3">
                <button id="play-cars-resampled-btn" class="btn btn-info me-2">Play Resampled Audio</button>
                <button id="predict-downsampled-speed-btn" class="btn btn-danger">üöó Predict Speed (Downsampled)</button>
            </div>
        </div>
    </div>

    <!-- Downsampled Speed Prediction Result -->
    <div id='downsampled-speed-result' class="mt-4 text-center" style="display: none;">
        <div class="card p-4" style="background-color: #0d1117; border: 3px solid #f78166;">
            <h3 style="color: #f78166;">üèéÔ∏è Predicted Speed (Downsampled Audio)</h3>
            <h1 id="downsampled-speed-value" style="color: #f78166; font-size: 4rem; font-weight: bold;">0.00 km/h</h1>
            <div class="row mt-3">
                <div class="col-md-6">
                    <small class="text-secondary">Downsampled Rate</small>
                    <p id="downsampled-sr-display" style="color: #c9d1d9;">-</p>
                </div>
                <div class="col-md-6">
                    <small class="text-secondary">Model</small>
                    <p id="downsampled-model-name" style="color: #c9d1d9;">CNN14</p>
                </div>
            </div>
        </div>
    </div>

    <!-- Resampled Audio Player -->
    <div id='audio-player-cars-resampled' class="mt-4" style="display: none;">
        <h5 style="color: #f78166;">Resampled Audio Player:</h5>
    </div>

    <!-- Resampled Audio Time Domain Graph -->
    <div class="graph-container mt-4" id="cars-resampled-graph-container" style="display: none;">
        <div id='time-domain-graph-cars-resampled' style='height: 350px;'></div>
    </div>

    <!-- Resampled Frequency Domain Graph -->
    <div class="graph-container mt-4" id="cars-resampled-freq-container" style="display: none;">
        <div id='frequency-domain-graph-cars-resampled' style='height: 350px;'></div>
    </div>

    <div id='cars-debug-info' class="mt-3 text-secondary" style="font-size: 0.8rem;"></div>
</div>
{% endblock %}

{% block extra_js %}
<script src="{% static 'js/detect_cars_logic.js' %}"></script>
{% endblock %}